<!DOCTYPE html>
<head>
<title>Sound Player</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<style>
		table {
			background-color: white;
		}
	</style>
	
	<script type="text/javascript">
		
		
		//var slider = document.getElementById("myRange");
		
		// Update the current slider value (each time you drag the slider handle)
		//slider.oninput = function() {
			// adjust volume
		//}
		var scenes = 1;
		var tracks = 1;
		
		$( document ).ready(function() {
			
			$("#btnNewScene").click(function() {
				createScene(scenes);
				scenes++;
			});
			
			
		});
		
		function getFilePath(){
			$('input[type=file]').change(function () {
				var filePath=$('#fileUpload').val(); 
				console.log(filePath);
				$("#txtFilename1").val(filePath);
			});
		}
		
		function createScene(sceneId) {
			var row = $('<tr></tr>').append(
				$('<td id="Scene' + sceneId + '"></td>').append(
					$("#sceneTemplate").html()
				)
			);
			$("#allScenes").append(row);
			
			// set listeners
			$("#Scene" + sceneId + " .sceneTitle").text("SCENE " + sceneId);
			$("#Scene" + sceneId + " .btnNewTrack").click(function() {
				console.log("createTrack(" + sceneId + ", " + tracks + ")");
				createTrack(sceneId, tracks);
			});
		}
		
		function createTrack(sceneId, trackId, defaultFilename="", defaultVolume=100) {
			
			var table = $('<table></table>').append(
				$('<tbody></tbody>').append(
					$('<tr></tr>').append(
						$('<td id="Track' + trackId + '"></td>').append(
							$("#trackTemplate").html()
						)
					)
				)
			);
			
			$("#Scene" + sceneId + " .trackTable").append(table);
			
			// set listeners
			$("#Track" + trackId + " .fileUpload").change(function () {
				var filePath=$("#Track" + trackId + " .fileUpload").val();
				if (filePath) {
					//parse the filename
					var startIndex = (filePath.indexOf('\\') >= 0 ? filePath.lastIndexOf('\\') : filePath.lastIndexOf('/'));
					var filename = filePath.substring(startIndex);
					if (filename.indexOf('\\') === 0 || filename.indexOf('/') === 0) {
						filename = filename.substring(1);
					}
					var txtTrackName = $("#Track" + trackId + " .txtFilename");
					txtTrackName.val(filename);
					txtTrackName.trigger("change");
				}
			});
			
			$("#Track" + trackId + " .txtFilename").change(function() {
				var file = $("#txtFilePath").val() + $(this).val();
				console.log('loading ' + file + '...');
				$("#Track" + trackId + " .audMp3Src").attr("src",file);
				$("#Track" + trackId + " .audOggSrc").attr("src",file);
				$("#Track" + trackId + " .audio").attr("src",file);
			});
			
			tracks++;
		}
		
		function removeTrack(sceneId, trackId) {
			if(trackId >= 0) {
				$("#trackTable" + sceneId).remove("track" + trackId);
			}
		}
		
		function loadSource(id) {
			var file = $("#txtFilePath").val() + $("#txtFilename" + id).val().name;
			console.log('loading ' + file + '...');
			$("#audOggSrc" + id).attr("src",file);
			document.getElementById('audio' + id).load();
		}
	</script>
</head>
<body bgcolor="#eeeeee">

	<!-- Global table -->
	<table>
		<tbody>
			<tr>
				<td>
					<button id="btnNewScene" type="button">Create New Scene</button>
				</td>
				<td>
					<label for="txtFilePath">Sound Files Path</label>
					<input type="text" name="filePath" id="txtFilePath" value="./sounds/">
				</td>
			</tr>
		</tbody>
	</table>
	
	<br/>
	
	
	
	<!-- Scenes table -->
	<table id="allScenes">
		<tbody>
			
		</tbody>
	</table>
	
</body>

<div id="sceneTemplate" style="display:none;">
	<table>
		<tbody>
			<tr>
				<td><input type="checkbox"  class="sceneCheckbox"></td>
				<td class="sceneTitle"></td>
			</tr>
			<tr>
			<td></td>
				<td>
					<!-- Scene Buttons -->
					<table>
						<tbody>
							<tr>
								<td><button class="btnNewTrack" type="button">Create New Track</button></td>
								<td><button class="btnRemoveTracks" type="button">Remove New Track(s)</button></td>
								<td><button class="btnPlayAll" type="button">Play All</button></td>
							</tr>
						</tbody>
					</table>
				</td>
			</tr>
			<tr>
				<td></td>
				<td class="trackTable">
				</td>
			</tr>
		</tbody>
	</table>
	<br/>
</div>

<div id="trackTemplate" style="display:none;">
	<table>
		<tbody>
			<tr>
				<td><input type="checkbox"  class="trackCheckbox"></td>
				<td>
					<audio class="audio" controls>
						<source class="audMp3Src" src="" type="audio/mp3">
						<source class="audOggSrc" src="" type="audio/ogg">
						Your browser does not support the audio tag.
					</audio>
				</td>
				<td>
					<div class="slidecontainer">
						<input type="range" min="1" max="100" value="100" class="volume">
					</div>
				</td>
				<td>
					<input class="txtFilename" value="">
					<input type="file" class="fileUpload">
				</td>
				<td>
					<button class="btnPlayTrack" type="button">Play</button>
				</td>
			</tr>
		</tbody>
	</table>
</div>

<!--
	<audio id="audio1" controls>
		<source src="./sounds/thunder1.ogg" type="audio/ogg">
		Your browser does not support the audio tag.
	</audio>
	<audio id="audio2" controls>
		<source src="./sounds/thunder2.ogg" type="audio/ogg">
		Your browser does not support the audio tag.
	</audio>
	<audio id="audio3" controls>
		<source src="./sounds/gentle_rain.ogg" type="audio/ogg">
		Your browser does not support the audio tag.
	</audio>-->